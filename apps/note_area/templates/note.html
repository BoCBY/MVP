{% extends "navbar.html" %}
{% load static %}

{% block note_active %}
active
{% endblock note_active %}

{% block note_active_span %}
<span class="sr-only">(current)</span>
{% endblock note_active_span %}
<!-- 上面這些完善導航條的外觀顯示 -->

{% block css %}

<link rel="stylesheet" href="{% static 'css/note_style1.css' %}">

{% endblock css %}

{% block content %}
<div class='area-container'>
    <a href='#'><button id="toAllNotes" type="button" class="btn btn-info" style='margin-top:0.5rem;'>所有筆記板</button></a>
    <div id='wholeAreaContainer'>
        <div id="selfDefined" class="region-container">
            <div class='d-flex justify-content-center'>
                <h5 class='header-style'>自由筆記區</h5>
                <div class='search-container'>
                    <a href='#'><i id='selfDefinedSearchIcon' class="fa-solid fa-magnifying-glass search-icon"></i></a>
                    <input id='selfDefinedSearchInput' class='search-input' type='text' placeholder='搜尋' style='display:none;'>
                </div>
            </div>
            <div class='display-data-container'>

            </div>
        </div>
        <div id="exerciseAns" class="region-container">
            <div class='d-flex justify-content-center'>
                <h5 class='header-style'>習題答案筆記區</h5>
            </div>
            <div class='container display-data-container'>
                <div id='subject'>
                    <p style='margin-bottom:0.2rem; margin-top:1rem;'><strong>科目</strong></p>
                    <button id="" subject='' type="button" class="btn btn-outline-secondary" style='padding: 0.1rem 0.2rem; margin-left:1.5rem;'>微積分</button>
                    <button id="" subject='' type="button" class="btn btn-outline-secondary" style='padding: 0.1rem 0.2rem;'>線性代數</button>
                    <button id="exerciseAnsMore" type="button" class="btn btn-outline-dark show-more" style='padding: 0.1rem 0.2rem;'><i class="fa-solid fa-ellipsis"></i></button>
                </div>
            </div>
            <div class='display-data-container'>

            </div>
        </div>
        <div id="learningArea" class="region-container" style='height:330px;'>
            <div class='d-flex justify-content-center'>
                <h5 class='header-style'>學習影片筆記區</h5>
            </div>
            <div class='container display-data-container'>
                <div id='course'>
                    <p style='margin-bottom:0.2rem; margin-top:1rem;'><strong>課名</strong></p>
                    <button type="button" class="btn btn-outline-secondary learning-area-course" style='padding: 0.1rem 0.2rem; margin-left:1.5rem;'>微積分</button>
                    <button type="button" class="btn btn-outline-secondary learning-area-course" style='padding: 0.1rem 0.2rem;'>線性代數</button>
                    <button id="learningAreaCourseMore" type="button" class="btn btn-outline-dark show-more" style='padding: 0.1rem 0.2rem;'><i class="fa-solid fa-ellipsis"></i></button>
                </div>
                <div id='lecturer'>
                    <p style='margin-bottom:0.2rem; margin-top:1rem;'><strong>授課者</strong></p>
                    <button type="button" class="btn btn-outline-secondary learning-area-lecturer" style='padding: 0.1rem 0.2rem; margin-left:1.5rem;'>朱樺</button>
                    <button type="button" class="btn btn-outline-secondary learning-area-lecturer" style='padding: 0.1rem 0.2rem;'>林秀豪</button>
                    <button id="learningAreaLecturerMore" type="button" class="btn btn-outline-dark show-more" style='padding: 0.1rem 0.2rem;'><i class="fa-solid fa-ellipsis"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 學習影片筆記區與習題答案筆記區的show-more modal -->
<div class="modal fade" id="showMoreModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title" id="showMoreModalLabel"><strong id='showMoreModalTitle'>Modal title</strong></h6>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id= 'showMoreTopContainer' class='container'>
              <div class='search-container d-flex justify-content-end'>
                <a href='#'><i id='showMoreSearchIcon' class="fa-solid fa-magnifying-glass search-icon"></i></a>
                <input id='showMoreSearchInput' class='search-input' type='text' placeholder='搜尋' style='display:none;'>
              </div>
          </div>
          <div id='displayDataContainer' class='container' style='margin-top:0.3rem;'>
            
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock content %}

{% block js %}

<script>

  $(function(){
    searchModule.init('showMoreSearchIcon', 'showMoreSearchInput', '#allSubjectContainer h5');
    searchModule.init('exerciseAnsSearchIcon', 'exerciseAnsSearchInput', '#allSubjectContainer h5');
    searchModule.init('selfDefinedSearchIcon', 'selfDefinedSearchInput', '#allSubjectContainer h5');
    showMore();
  })

// Define a search module
const searchModule = (function() {
    // Private functions
    function toggleSearchInput(searchInputId) {
        $(`#${searchInputId}`).toggle();
        if ($(`#${searchInputId}`).is(":visible")) {
            $(`#${searchInputId}`).focus(); // Focus on the input field when it becomes visible
        }
    
        $(document).on('click', function(event) {
            if (!$(event.target).closest('.search-container').length && !$(event.target).is('.search-container')) {
                $(`#${searchInputId}`).hide();
            }
        });
    }
    
    function filter(searchInputId, searchArea) {
        let searchText = $(`#${searchInputId}`).val().toLowerCase();
    
        if(searchArea === '#displayFileContainer a'){
        // for ansSearchInput
          $(searchArea).each(function() {
              let text = $(this).text().toLowerCase();
      
              if (text.includes(searchText)) {
                  $(this).parent().parent().show();
              } else {
                  $(this).parent().parent().hide();
              }
          });
        }else if(searchArea === '#allSubjectContainer h5'){
            // for subjectSearchInput
            $(searchArea).each(function() {
                let text = $(this).text();
                if (text.includes(searchText)) {
                    $(this).closest(".subject-container").show();
                } else {
                    $(this).closest(".subject-container").hide();
                }
            });
        }else{
            // for each subject searchInput ex: mathSearchInput, physicsSearchInput 
            $(searchArea).each(function() {
                let text = $(this).text();
        
                if (text.includes(searchText)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
        });
    }
    }
  
    // Public function
    function init(searchIconId, searchInputId, searchArea) {
        $(`#${searchIconId}`).click(function(event) {
            event.preventDefault();
            toggleSearchInput(searchInputId);
        });
        $(`#${searchInputId}`).on('input', function() {
            filter(searchInputId, searchArea);
        });
    }
  
    // Expose public functions
    return {
        init: init
    };
  })();

function showMore(){
    $('.show-more').click(function(){
        /* 處理標題 */
        let $this = $(this);
        let head = $(this).closest('.region-container').find('h5.header-style').text();
        let head2 = $(this).parent().find('p').text();
        title = head + ' - ' + head2
        $('#showMoreModalTitle').text(title);

        /* 處理傳送到後台的資料 */
        let id = $this.attr('id');
        $.ajax({
            url: '/note/',
            type: 'post',
            data:{
                'purpose': 'showMore',
                'id': id,
            },
            dataType: 'JSON',
            success: function(res){
                if (res.status){
                    $('#displayDataContainer').empty();
                    if(id==='learningAreaCourseMore'){
                        // 製造學習影片區課名的按鈕
                        $.each(res.data, function(index, course){
                            let button = $('<button>').attr({'type':'button', 'class':'btn btn-outline-secondary learning-area-course', 'style':'padding: 0.1rem 0.2rem; margin:0.2rem;'}).text(course);
                            $('#displayDataContainer').append(button);
                            })
                    }else if(id==='learningAreaLecturerMore'){
                        // 製造學習影片區授課者的按鈕
                        $.each(res.data, function(index, course){
                            let button = $('<button>').attr({'type':'button', 'class':'btn btn-outline-secondary learning-lecturer-course', 'style':'padding: 0.1rem 0.2rem; margin:0.2rem;'}).text(course);
                            $('#displayDataContainer').append(button);
                            })
                    }

                    //<button type="button" class="btn btn-outline-secondary learning-area-course" style='padding: 0.1rem 0.2rem; margin-left:1.5rem;'>微積分</button>
                    //<button type="button" class="btn btn-outline-secondary learning-area-lecturer" style='padding: 0.1rem 0.2rem; margin-left:1.5rem;'>朱樺</button>
                    $('#showMoreModal').modal('show');
                }else{

                }
            }
        })
    })
}

function selfDefinedShowMore(){

}
</script>

{% endblock js %}